# JavaScript
## Callback í•¨ìˆ˜
- ìžë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ synchronous.
- ìžë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ìœ„ì—ì„œ ì•„ëž˜ë¡œ ìˆ˜í–‰ëœë‹¤.
```javascript
console.log('1');
setTimeout(() => {
    console.log('2');
}, 1000);
console.log('3');
```
- setTimeoutì€ ë¸Œë¼ìš°ì €ì—ì„œ ì œê³µí•˜ëŠ” í•¨ìˆ˜ë¡œ, ë¸Œë¼ìš°ì €ì— 1ì´ˆ ì´í›„ì— ì € callback í•¨ìˆ˜ë¥¼ ìˆ˜í–‰í•´ë‹¬ë¼ê³  í•˜ëŠ” ê²ƒì´ë‹¤.
- ì „ë‹¬í•˜ëŠ” í•¨ìˆ˜ëŠ” ì§€ê¸ˆ ë‹¹ìž¥ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆê³ , 'ë‚˜ì¤‘ì— ë‹¤ì‹œ ë¶ˆëŸ¬ì¤˜' ë¼ê³  í•´ì„œ callbackì´ë¼ê³  ë¶€ë¥¸ë‹¤. 
- callbackë„ ë‘ ê°€ì§€ë¡œ ë‚˜ë‰œë‹¤.
  - Synchronous callback
  - Asynchronous callback
```javascript
// Synchronous callback
function printImmediately(print) {
    print();
}
printImmediately(() => console.log('hello'));

// Asynchronous callback
// setTimeoutì„ wrappingí•˜ê³  ìžˆëŠ” í•¨ìˆ˜
function printWithDelay(print, delay) {
    setTimeout(print, delay);
}
printWithDelay(() => console.log('async callback'), 2000);
```
- ì½œë°± ì§€ì˜¥ì´ëž€ ì½œë°± ì•ˆì— ì½œë°±ì„ ì •ì˜í•˜ëŠ” í˜•íƒœë¥¼ ë§í•œë‹¤.
```javascript
// Callback Hell example
class UserStorage {
    // ì‚¬ìš©ìž ë¡œê·¸ì¸ ì²˜ë¦¬
    // ì„±ê³µí•  ê²½ìš° onSuccess ì½œë°± í•¨ìˆ˜ í˜¸ì¶œ
    // ì‹¤íŒ¨í•  ê²½ìš° onError ì½œë°± í•¨ìˆ˜ í˜¸ì¶œ
    loginUser(id, password, onSuccess, onError) {
        setTimeout(() => {
            if (
                (id === 'ellie' && password === 'dream') ||
                (id === 'coder' && password === 'academy')
            ) {
                onSuccess(id);
            } else {
                onError(new Error('not found'));
            }
        }, 2000);
    }
    // ì‚¬ìš©ìžì˜ ì •ë³´ë¥¼ ìš”ì²­í•´ì„œ ë°ì´í„°ë¥¼ ë°›ëŠ” í•¨ìˆ˜
    // ì„±ê³µí•  ê²½ìš° onSuccess ì½œë°± í•¨ìˆ˜ í˜¸ì¶œ
    // ì‹¤íŒ¨í•  ê²½ìš° onError ì½œë°± í•¨ìˆ˜ í˜¸ì¶œ
    getRoles(user, onSuccess, onError) {
        setTimeout(() => {
            if (user === 'ellie') {
                onSuccess({ name: 'ellie', role: 'admin' });
            } else {
                onError(new Error('no access'));
            }
        }, 1000);
    }
}

const id = prompt('enter your id');
const password = prompt('enter your password');
const userStorage = new UserStorage();
userStorage.loginUser(
    id, 
    password, 
    user => {
        // console.log(user + 'ë¡œ ë¡œê·¸ì¸ ë˜ì—ˆìŠµë‹ˆë‹¤.');
        userStorage.getRoles(
            user, 
            userWithRole => {
                alert(
                    `Hello ${userWithRole.name}, you have a ${userWithRole.role} role`
                );
            },
            error => {
                console.log(error);
            }
        );
    },
    error => {
        console.log(error);
    }
);
```
- ì½œë°±ì˜ ê²°ê³¼ë¡œ ë˜ ë‹¤ë¥¸ ì½œë°±ì— ì „ë‹¬í•˜ê³  í•˜ëŠ” ê²½ìš°.
- ì½”ë“œì˜ ê°€ë…ì„±ì´ ë§¤ìš° ë–¨ì–´ì§„ë‹¤.
- ë””ë²„ê¹…í•˜ëŠ” ê²ƒì´ ì–´ë µê³ , ìœ ì§€ë³´ìˆ˜ ë˜í•œ ì–´ë ¤ì›Œì§„ë‹¤.
- Promiseë¥¼ ì ìš©í•˜ë¯€ë¡œì¨ ì´ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìžˆë‹¤.

## Promise
- JavaScriptì—ì„œ ì œê³µí•˜ëŠ” ë¹„ë™ê¸°ë¥¼ ê°„íŽ¸í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìžˆë„ë¡ ë„ì™€ì£¼ëŠ” ì˜¤ë¸Œì íŠ¸.
- PromiseëŠ” ì •í•´ì§„ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ê³ ë‚˜ì„œ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ëœ ê²½ìš° ì„±ê³µ ë©”ì‹œì§€ì™€ ì²˜ë¦¬ëœ ê²°ê³¼ê°’ì„ ì „ë‹¬í•´ì£¼ê³ , ì²˜ë¦¬í•˜ë‹¤ ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš° ì—ëŸ¬ë¥¼ ì „ë‹¬í•´ì¤€ë‹¤.
- PromiseëŠ” ìžë°”ìŠ¤í¬ë¦½íŠ¸ ì•ˆì— ë‚´ìž¥ë˜ì–´ ìžˆëŠ” ì˜¤ë¸Œì íŠ¸. ë¹„ë™ê¸°ì ì¸ ê²ƒì„ ìˆ˜í–‰í•  ë•Œ ì½œë°± ëŒ€ì‹  ìœ ìš©í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìžˆëŠ” ì˜¤ë¸Œì íŠ¸.
- Promise í•™ìŠµ í¬ì¸íŠ¸
  1. State => ìˆ˜í–‰ì¤‘ì¸ì§€ ì™„ë£ŒëëŠ”ì§€ 
  2. Producer / Consumerì˜ ì°¨ì´ì ì— ëŒ€í•œ ì´í•´

### State
- Promiseê°€ ë§Œë“¤ì–´ì ¸ì„œ ì§€ì •í•œ operationì„ ìˆ˜í–‰ì¤‘ì¼ ë•ŒëŠ” pending ìƒíƒœ
- operationì„ ì„±ê³µì ìœ¼ë¡œ ëë‚´ê²Œëœ ê²½ìš° fullfilled ìƒíƒœ
- íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ ë„¤íŠ¸ì› ë¬¸ì œë¡œ ì¸í•´ ì‹¤íŒ¨ ì‹œ rejected ìƒíƒœ

### Producer / Consumer
- ìš°ë¦¬ê°€ ì›í•˜ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•´ì„œ í•´ë‹¹í•˜ëŠ” ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ë‚´ëŠ” ì—­í•  => Producer
- ê·¸ ë°ì´í„°ë¥¼ ì†Œë¹„í•˜ëŠ” ì—­í•  => Consumer

1. Producer
   - Promiseë¥¼ ë°˜í™˜í•˜ëŠ” ë¶€ë¶„ì„ ë§í•œë‹¤.
   ```javascript
   const promise = new Promise((resolve, reject) => {
       // ë¬´ê±°ìš´ ì¼ì„ ìˆ˜í–‰í•œë‹¤. (ë„¤íŠ¸ì›Œí¬ í†µì‹ ,, ë“±,,)
       // ì‹œê°„ì´ ì˜¤ëž˜ ê±¸ë¦¬ëŠ” ìž‘ì—…ì„ ë™ê¸°ì ìœ¼ë¡œ ìˆ˜í–‰í•  ê²½ìš°, 
       // ë‹¤ìŒ ë¼ì¸ì´ ìˆ˜í–‰ì´ ì•ˆë˜ê³  ìžˆì„ ê²ƒì´ê¸° ë•Œë¬¸ì—,,
       // ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
       console.log('doing something...');
       setTimeout(() => {
           resolve('ellie');
           // reject(new Error('no network'));
       }, 2000);
   });
   ```
   - í”„ë¡œë¯¸ìŠ¤ ë‚´ë¶€ì—ëŠ” ë„¤íŠ¸ì›Œí¬ í†µì‹ , íŒŒì¼ ì½ê¸° ë“± ì‹œê°„ì´ ì˜¤ëž˜ ê±¸ë¦¬ëŠ” ìž‘ì—…ì„ ì£¼ë¡œ ìž‘ì„±í•œë‹¤.
   - í”„ë¡œë¯¸ìŠ¤ë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ì‹œê°„ì´ ì˜¤ëž˜ ê±¸ë¦¬ëŠ” ìž‘ì—…ë“¤ì„ ë™ê¸°ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ì§€ ì•Šê³  ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬ë˜ë„ë¡ í•œë‹¤.
   - í”„ë¡œë¯¸ìŠ¤ ê°ì²´ë¥¼ ìƒì„±í•  ë•ŒëŠ” executor ì½œë°± í•¨ìˆ˜ë¥¼ ì „ë‹¬í•´ì¤˜ì•¼ í•˜ëŠ”ë°, ê·¸ ì½œë°± í•¨ìˆ˜ëŠ” ë‚´ë¶€ì— íŒŒë¼ë¯¸í„°ë¡œ ë˜ ë‹¤ë¥¸ ì½œë°± í•¨ìˆ˜ ë‘ ê°œë¥¼ ë°›ëŠ”ë‹¤. => resolveì™€ reject
   - resolveëŠ” ê¸°ëŠ¥ì„ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰í•´ì„œ ë§ˆì§€ë§‰ì— ìµœì¢… ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ” ì½œë°± í•¨ìˆ˜
   - rejectëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ë‹¤ê°€ ì¤‘ê°„ì— ë¬¸ì œê°€ ìƒê¸´ ê²½ìš° ìˆ˜í–‰ë˜ëŠ” ì½œë°± í•¨ìˆ˜. rejectëŠ” ë³´í†µ ìžë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•˜ëŠ” Error ì˜¤ë¸Œì íŠ¸ë¥¼ ì‚¬ìš©í•´ì„œ ê°’ì„ ì „ë‹¬í•œë‹¤.
   - **í”„ë¡œë¯¸ìŠ¤ë¥¼ ë§Œë“œëŠ” ìˆœê°„ executor ì½œë°± í•¨ìˆ˜ê°€ ë°”ë¡œ ìˆ˜í–‰ì´ ëœë‹¤ëŠ” ì ì„ ìœ ì˜í•´ì•¼ í•œë‹¤.**

2. Consumer
    - then, catch, finallyë¥¼ í†µí•´ì„œ ê°’ì„ ë°›ì•„ì˜¬ ìˆ˜ ìžˆë‹¤.
    - ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ëœ ê²½ìš° => then, resolveì—ì„œ ë„˜ê¸´ íŒŒë¼ë¯¸í„°ê°’ìœ¼ë¡œ ì „ë‹¬ëœë‹¤.
    - ì—ëŸ¬ ë°œìƒ ì‹œ => catch, rejectì—ì„œ ë„˜ê¸´ íŒŒë¼ë¯¸í„°ê°’ìœ¼ë¡œ ì „ë‹¬ëœë‹¤.
    - ì„±ê³µ/ì‹¤íŒ¨ ìƒê´€ì—†ì´ ë¬´ì¡°ê±´ ë§ˆì§€ë§‰ì— ìˆ˜í–‰ë˜ëŠ” í•¨ìˆ˜ => finally
    ```javascript
    promise
    .then(value => {
        console.log(value);
    })
    .catch(error => {
        console.log(error);
    })
    .finally(() => {
        console.log('finally');
    });
    ```
    - thenì˜ ê²°ê³¼ë¡œ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë¦¬í„´í•˜ê¸° ë•Œë¬¸ì— ê·¸ ë¦¬í„´ëœ í”„ë¡œë¯¸ìŠ¤ë¡œ ë‹¤ì‹œ catchí•  ìˆ˜ ìžˆë‹¤.


### Promise Chaining
```javascript
const fetchNumber = new Promise((resolve, reject) => {
    setTimeout(() => resolve(1), 1000);
});

fetchNumber
    .then(num => num * 2)
    .then(num => num * 3)
    .then(num => {
        return new Promise((resolve, reject) => {
            setTimeout(() => resolve(num - 1), 1000);
        });
    })
    .then(num => console.log(num));
```
- thenì˜ ê²½ìš° promise ë˜ëŠ” ê°’ì„ ì „ë‹¬í•œë‹¤.


### Error Handling
```javascript
const getHen = () => 
    new Promise((resolve, reject) => {
        setTimeout(() => resolve('ðŸ“'), 1000);
    });
const getEgg = hen => 
    new Promise((resolve, reject) => {
        setTimeout(() => {
            // resolve(`${hen} => ðŸ¥š`),
            reject(new Error(`error! ${hen} => ðŸ¥š`)),
            1000
        });
    });
const cook = egg => 
    new Promise((resolve, reject) => {
        setTimeout(() => resolve(`${egg} => ðŸ³`), 1000);
    });

// getHen()
//     .then(hen => getEgg(hen))
//     .then(egg => cook(egg))
//     .then(meal => console.log(meal));

// í•œê°€ì§€ë§Œ ë°›ì•„ì„œ ë°”ë¡œ ë„˜ê¸°ëŠ” ê²½ìš° ìƒëžµ ê°€ëŠ¥
getHen()
    .then(getEgg)
    // ê³„ëž€ì„ ë°›ì•„ì˜¬ ë•Œ ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš° ë¹µì„ ë¦¬í„´í•˜ë„ë¡ ì²˜ë¦¬
    .catch(error => {
        return 'ðŸž';
    })
    .then(cook)
    .then(console.log)
    .catch(console.log);
```
- getHenì„ ìˆ˜í–‰ í›„ ê·¸ ê²°ê³¼ë¡œ getEggë¥¼ ìˆ˜í–‰í•  ë•Œ ë§Œì•½ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ê²½ìš° catch í•¨ìˆ˜ì—ì„œ ë‹¤ë¥¸ ê°’ì„ ë¦¬í„´í•´ì„œ ì „ë‹¬í•¨ìœ¼ë¡œì¨ ì´í›„ ë¡œì§ì´ ìˆ˜í–‰ë  ìˆ˜ ìžˆê²Œ í•  ìˆ˜ ìžˆë‹¤.

### Callback -> Promise ì „í™˜
```javascript
// Callback Hell example
class UserStorage {
    // ì‚¬ìš©ìž ë¡œê·¸ì¸ ì²˜ë¦¬
    loginUser(id, password) {
        return new Promise((resolve, reject) => {
            setTimeout(() => {
                if (
                    (id === 'ellie' && password === 'dream') ||
                    (id === 'coder' && password === 'academy')
                ) {
                    resolve(id);
                } else {
                    reject(new Error('not found'));
                }
            }, 2000);
        });
    }
    // ì‚¬ìš©ìžì˜ ì •ë³´ë¥¼ ìš”ì²­í•´ì„œ ë°ì´í„°ë¥¼ ë°›ëŠ” í•¨ìˆ˜
    getRoles(user) {
        return new Promise((resolve, reject) => {
            setTimeout(() => {
                if (user === 'ellie') {
                    resolve({ name: 'ellie', role: 'admin' });
                } else {
                    reject(new Error('no access'));
                }
            }, 1000);
        });
    }
}

const id = prompt('enter your id');
const password = prompt('enter your password');
const userStorage = new UserStorage();
userStorage
    .loginUser(id, password)
    .then(userStorage.getRoles)
    .then(user => alert(`Hello ${user.name}, you have a ${user.role} role`))
    .catch(console.log);
```
